/*! angular-date-range-picker 2013-11-10 */
(function(){angular.module("dateRangePicker",["pasvaz.bindonce"]),angular.module("dateRangePicker").directive("dateRangePicker",["$compile",function(a){var b,c,d;return d='<div ng-show="visible" class="angular-date-range-picker__picker" ng-click="handlePickerClick($event)">\n  <div class="angular-date-range-picker__timesheet">\n    <button ng-click="move(-1, $event)" class="angular-date-range-picker__prev-month">&#9664;</button>\n    <div bindonce ng-repeat="month in months" class="angular-date-range-picker__month">\n      <div class="angular-date-range-picker__month-name" bo-text="month.name"></div>\n      <table class="angular-date-range-picker__calendar">\n        <tr>\n          <th bindonce ng-repeat="day in month.weeks[1]" class="angular-date-range-picker__calendar-weekday" bo-text="day.date.format(\'dd\')">\n          </th>\n        </tr>\n        <tr bindonce ng-repeat="week in month.weeks">\n          <td\n              bo-class=\'{\n                "angular-date-range-picker__calendar-day": day,\n                "angular-date-range-picker__calendar-day-selected": day.selected,\n                "angular-date-range-picker__calendar-day-disabled": day.disabled,\n                "angular-date-range-picker__calendar-day-start": day.start\n              }\'\n              ng-repeat="day in week track by $index" ng-click="select(day, $event)" bo-text="day.date.date()">\n          </td>\n        </tr>\n      </table>\n    </div>\n    <button ng-click="move(+1, $event)" class="angular-date-range-picker__next-month">&#9654;</button>\n  </div>\n  <div class="angular-date-range-picker__panel">\n    <div>\n      Select range: <select ng-click="prevent_select($event)" ng-model="quick" ng-options="e.range as e.label for e in quickList"></select>\n    </div>\n    <div class="angular-date-range-picker__buttons">\n      <button ng-click="ok($event)" class="angular-date-range-picker__apply">Apply</button>\n      <a ng-click="hide($event)" class="angular-date-range-picker__cancel">cancel</a>\n    </div>\n  </div>\n</div>',c=moment().range("2013-01-01","2013-01-02"),b="CUSTOM",{restrict:"AE",replace:!0,template:'<span class="angular-date-range-picker__input">\n  <span ng-show="model">{{ model.start.format("ll") }} - {{ model.end.format("ll") }}</span>\n  <span ng-hide="model">Select date range</span>\n</span>',scope:{model:"=ngModel"},link:function(e,f){var g,h,i,j,k;return e.quickListDefinitions=[{label:"This week",range:moment().range(moment().startOf("week").startOf("day"),moment().endOf("week").startOf("day"))},{label:"Next week",range:moment().range(moment().startOf("week").add(1,"week").startOf("day"),moment().add(1,"week").endOf("week").startOf("day"))},{label:"This fortnight",range:moment().range(moment().startOf("week").startOf("day"),moment().add(1,"week").endOf("week").startOf("day"))},{label:"This month",range:moment().range(moment().startOf("month").startOf("day"),moment().endOf("month").startOf("day"))},{label:"Next month",range:moment().range(moment().startOf("month").add(1,"month").startOf("day"),moment().add(1,"month").endOf("month").startOf("day"))}],e.quick=null,e.range=null,e.selecting=!1,e.visible=!1,e.start=null,j=function(a){var c,d,f,g,h;for(null==a&&(a=!1),e.quickList=[],a&&e.quickList.push({label:"Custom",range:b}),g=e.quickListDefinitions,h=[],d=0,f=g.length;f>d;d++)c=g[d],h.push(e.quickList.push(c));return h},h=function(){var a,b;return e.range=e.selection?(b=e.selection.start.clone().startOf("month").startOf("day"),a=b.clone().add(2,"months").endOf("month").startOf("day"),moment().range(b,a)):moment().range(moment().startOf("month").subtract(1,"month").startOf("day"),moment().endOf("month").add(1,"month").startOf("day"))},i=function(){var a,c,d,f;if(e.selection){for(f=e.quickList,c=0,d=f.length;d>c;c++)if(a=f[c],a.range!==b&&e.selection.start.startOf("day").unix()===a.range.start.startOf("day").unix()&&e.selection.end.startOf("day").unix()===a.range.end.startOf("day").unix())return e.quick=a.range,j(),void 0;return e.quick=b,j(!0)}},k=function(){var a,b,d,f,g,h;for(e.months=[],d=12*e.range.start.year()+e.range.start.month(),b=moment().startOf("week").day(),e.range.by(c,function(a){var c,f,g,h,i,j,k;return c=a.day()-b,0>c&&(c=7+c),g=12*a.year()+a.month()-d,i=parseInt((7+a.date()-c)/7),h=!1,f=!1,e.start?(h=a===e.start,f=a<e.start):h=e.selection&&e.selection.contains(a),(j=e.months)[g]||(j[g]={name:a.format("MMMM YYYY"),weeks:[]}),(k=e.months[g].weeks)[i]||(k[i]=[]),e.months[g].weeks[i][c]={date:a,selected:h,disabled:f,start:e.start&&e.start.unix()===a.unix()}}),h=e.months,f=0,g=h.length;g>f;f++)a=h[f],a.weeks[0]||a.weeks.splice(0,1);return i()},e.show=function(){return e.selection=e.model,h(),k(),e.visible=!0},e.hide=function(a){return null!=a&&"function"==typeof a.stopPropagation&&a.stopPropagation(),e.visible=!1},e.prevent_select=function(a){return null!=a?"function"==typeof a.stopPropagation?a.stopPropagation():void 0:void 0},e.ok=function(a){return null!=a&&"function"==typeof a.stopPropagation&&a.stopPropagation(),e.model=e.selection,e.hide()},e.select=function(a,b){return null!=b&&"function"==typeof b.stopPropagation&&b.stopPropagation(),a.disabled?void 0:(e.selecting=!e.selecting,e.selecting?(e.start=a.date,k()):(e.selection=moment().range(e.start,a.date),e.start=null,k()))},e.move=function(a,b){return null!=b&&"function"==typeof b.stopPropagation&&b.stopPropagation(),e.range=moment().range(e.range.start.add(a,"months").startOf("month").startOf("day"),e.range.start.clone().add(2,"months").endOf("month").startOf("day")),k()},e.handlePickerClick=function(a){return null!=a?"function"==typeof a.stopPropagation?a.stopPropagation():void 0:void 0},e.$watch("quick",function(a){return a&&a!==b?(e.selection=e.quick,e.selecting=!1,e.start=null,h(),k()):void 0}),g=a(angular.element(d))(e),f.append(g),f.bind("click",function(a){return null!=a&&"function"==typeof a.stopPropagation&&a.stopPropagation(),e.$apply(function(){return e.visible?e.hide():e.show()})}),angular.element(document).bind("click",function(){return e.$apply(function(){return e.hide()})}),j(),h(),k()}}}])}).call(this);